local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")

local LocalPlayer = Players.LocalPlayer

local Enabled = false
local UI_Locked = false
local SelectedPlayer = nil
local Range = 50

local function getEquippedTool()
    local char = LocalPlayer.Character
    if not char then return nil end
    for _, v in ipairs(char:GetChildren()) do
        if v:IsA("Tool") then
            return v
        end
    end
end

local ScreenGui = Instance.new("ScreenGui", game.CoreGui)
ScreenGui.ResetOnSpawn = false

local MainFrame = Instance.new("Frame", ScreenGui)
MainFrame.Size = UDim2.new(0, 260, 0, 200)
MainFrame.Position = UDim2.new(0.5, -130, 0.5, -100)
MainFrame.BackgroundColor3 = Color3.fromRGB(25, 25, 25)
MainFrame.BorderSizePixel = 0

local ToggleButton = Instance.new("TextButton", MainFrame)
ToggleButton.Size = UDim2.new(0, 110, 0, 30)
ToggleButton.Position = UDim2.new(0, 10, 0, 10)
ToggleButton.Text = "OFF"
ToggleButton.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
ToggleButton.TextColor3 = Color3.new(1,1,1)
ToggleButton.BorderSizePixel = 0

local LockButton = Instance.new("TextButton", MainFrame)
LockButton.Size = UDim2.new(0, 110, 0, 30)
LockButton.Position = UDim2.new(0, 140, 0, 10)
LockButton.Text = "LOCK UI"
LockButton.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
LockButton.TextColor3 = Color3.new(1,1,1)
LockButton.BorderSizePixel = 0

local TargetBox = Instance.new("TextBox", MainFrame)
TargetBox.Size = UDim2.new(0, 240, 0, 30)
TargetBox.Position = UDim2.new(0, 10, 0, 50)
TargetBox.PlaceholderText = "Player name"
TargetBox.Text = ""
TargetBox.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
TargetBox.TextColor3 = Color3.new(1,1,1)
TargetBox.BorderSizePixel = 0

local SliderFrame = Instance.new("Frame", MainFrame)
SliderFrame.Size = UDim2.new(0, 240, 0, 20)
SliderFrame.Position = UDim2.new(0, 10, 0, 100)
SliderFrame.BackgroundColor3 = Color3.fromRGB(35,35,35)
SliderFrame.BorderSizePixel = 0

local Bar = Instance.new("Frame", SliderFrame)
Bar.Size = UDim2.new(1, 0, 0, 6)
Bar.Position = UDim2.new(0, 0, 0.5, -3)
Bar.BackgroundColor3 = Color3.fromRGB(55,55,55)
Bar.BorderSizePixel = 0

local Fill = Instance.new("Frame", Bar)
Fill.Size = UDim2.new(0, 0, 1, 0)
Fill.BackgroundColor3 = Color3.fromRGB(120,120,120)
Fill.BorderSizePixel = 0

local Knob = Instance.new("Frame", SliderFrame)
Knob.Size = UDim2.new(0, 12, 0, 12)
Knob.Position = UDim2.new(0, -6, 0.5, -6)
Knob.BackgroundColor3 = Color3.fromRGB(200,200,200)
Knob.BorderSizePixel = 0

local RangeLabel = Instance.new("TextLabel", MainFrame)
RangeLabel.Size = UDim2.new(0, 240, 0, 20)
RangeLabel.Position = UDim2.new(0, 10, 0, 125)
RangeLabel.Text = "Range: 50"
RangeLabel.BackgroundTransparency = 1
RangeLabel.TextColor3 = Color3.new(1,1,1)

ToggleButton.MouseButton1Click:Connect(function()
    Enabled = not Enabled
    ToggleButton.Text = Enabled and "ON" or "OFF"
end)

LockButton.MouseButton1Click:Connect(function()
    UI_Locked = not UI_Locked
    LockButton.Text = UI_Locked and "UNLOCK UI" or "LOCK UI"
end)

TargetBox.FocusLost:Connect(function()
    SelectedPlayer = Players:FindFirstChild(TargetBox.Text)
end)

local draggingUI, dragStart, startPos
MainFrame.InputBegan:Connect(function(input)
    if UI_Locked then return end
    if input.UserInputType == Enum.UserInputType.MouseButton1 then
        draggingUI = true
        dragStart = input.Position
        startPos = MainFrame.Position
    end
end)

MainFrame.InputEnded:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 then
        draggingUI = false
    end
end)

local draggingSlider = false
Knob.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 then
        draggingSlider = true
    end
end)

UserInputService.InputEnded:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 then
        draggingSlider = false
    end
end)

UserInputService.InputChanged:Connect(function(input)
    if draggingUI and input.UserInputType == Enum.UserInputType.MouseMovement then
        local delta = input.Position - dragStart
        MainFrame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
    end

    if draggingSlider and input.UserInputType == Enum.UserInputType.MouseMovement then
        local barPos = Bar.AbsolutePosition.X
        local barSize = Bar.AbsoluteSize.X
        local percent = math.clamp((input.Position.X - barPos) / barSize, 0, 1)
        Range = math.floor(1 + percent * 299)
        Fill.Size = UDim2.new(percent, 0, 1, 0)
        Knob.Position = UDim2.new(percent, -6, 0.5, -6)
        RangeLabel.Text = "Range: "..Range
    end
end)

RunService.RenderStepped:Connect(function()
    if not Enabled then return end
    if not SelectedPlayer then return end

    local char = SelectedPlayer.Character
    local myChar = LocalPlayer.Character
    if not char or not myChar then return end

    local hrp1 = myChar:FindFirstChild("HumanoidRootPart")
    local hrp2 = char:FindFirstChild("HumanoidRootPart")
    if not hrp1 or not hrp2 then return end

    if (hrp1.Position - hrp2.Position).Magnitude > Range then return end

    local tool = getEquippedTool()
    if not tool or not tool:FindFirstChild("Handle") then return end

    firetouchinterest(tool.Handle, hrp2, 0)
    firetouchinterest(tool.Handle, hrp2, 1)
end)
